# v0.2 Development Log

**Version:** v0.2
**Branch:** v0.2-dev
**Focus:** Bug Fixes Only
**Started:** 2025-10-03

---

## ðŸŽ¯ v0.2 Goals

**Primary Objective:** Fix all critical bugs from v0.1 playtest

**Secondary Objective:** Maintain stability, no new features

**Philosophy:**
> "fixing the bugs first is priority. and then implementing when set. these ideas can be saved for v0.3 as well."

---

## ðŸ› Bugs to Fix (From v0.1-BUGS-TO-FIX.md)

### Critical Bugs
- [ ] **Building Construction Error** (HIGH)
  - Error: `unsupported operand type(s) for *: 'float' and 'ResourceManager'`
  - Occurs when building second Solar Array or Mining Rigs
  - Type error in production calculation

- [ ] **Research Purchase Error** (HIGH)
  - Error: `UpgradeManager.purchase() takes 2 positional arguments but 3 were given`
  - Occurs when purchasing research upgrades
  - Method signature mismatch

### UI Issues
- [ ] **Main Menu Flickering** (HIGH)
  - Menu flickers, making it hard to input commands
  - User has to "catch the letter" before it disappears
  - Affects gameplay experience significantly

- [ ] **Border Alignment** (MEDIUM)
  - Borders not properly aligned
  - Visual polish issue

---

## ðŸ“ Development Log

### 2025-10-03 - Planning Session

**Actions:**
- Created v0.3-FEATURES.md (pushed features to future version)
- Created PHILOSOPHY.md (Null Studio, Lattice Engine, Colony.sh)
- Created GIT-WORKFLOW.md (branching and commit instructions)
- Updated Idea_Reservoir.md (added version stamp system)
- Created this devlog for v0.2 tracking

**Decisions:**
- v0.2 = Bugs only, no features
- v0.3 = Feature additions (dialogs, visuals, animations, etc.)
- Keep separate documentation for each version
- Version stamp all new ideas: `[vX.X Planning - YYYY-MM-DD]`

**Next Steps:**
1. Create v0.2-dev branch
2. Fix building construction error (priority 1)
3. Fix research purchase error (priority 2)
4. Fix menu flickering (priority 3)
5. Fix border alignment (priority 4)
6. Test thoroughly
7. Merge to main when stable

---

### 2025-10-03 - Bug Fixes Complete

**What Changed:**
- Fixed building construction type error (build_menu.py)
- Fixed research purchase argument error (research_menu.py)
- Fixed menu flickering by reducing render rate (main.py)
- Fixed border alignment across all UI files (main_screen.py, build_menu.py, research_menu.py, help_screen.py, main.py)
- Fixed production rate initialization for starting buildings (loader.py)

**Issues Encountered:**
- Building/research methods were being called with wrong number of arguments (passing resource_manager when not needed)
- Screen refreshing 5 times per second caused flickering
- Borders had inconsistent widths (71-73 chars instead of standard 74 chars)
- Starting buildings didn't have production rates initialized

**Solutions:**
- Removed extra `game_state.resources` parameter from `build()` and `purchase()` calls
- Changed render interval from 1.0/5.0 (5 FPS) to 1.0/2.0 (2 FPS)
- Standardized all borders to 74 characters width (2 border chars + 1 space + 69 content + 1 space + 1 border char)
- Added `_update_production_rates()` call after setting starting building counts in loader

**Testing Notes:**
- Game initialization: âœ… PASSED
- Resource loading: âœ… PASSED (4 resources)
- Building loading: âœ… PASSED (5 buildings)
- Upgrade loading: âœ… PASSED (4 upgrades)
- Production rates: âœ… PASSED (energy 3.0/s from Solar Array)
- Building construction: âœ… PASSED (Mining Rig built successfully)
- Research purchase: âœ… PASSED (Efficient Extraction purchased successfully)

**Next Steps:**
- Ready for playtest
- If playtest successful, merge to main

---

### 2025-10-03 - Post-Playtest Bug Fixes (Round 2)

**What Changed:**
- Increased render FPS from 2 to 30 to reduce flickering (main.py:68)
- Fixed remaining border alignment issues in separator lines:
  - build_menu.py:136 - Changed separator to 74 chars
  - research_menu.py:168 - Changed separator to 74 chars
  - help_screen.py:115 - Changed separator to 74 chars
- Fixed energy number jumping issue (engine/buildings.py:429-446)
  - Updated _update_production_rates() to account for consumption
  - Now calculates net rate (production - consumption) immediately
- Improved save message clarity (main.py:240-243)
  - Shows save file name and current Sol day
  - Message: "Colony saved to colony_save.json (Sol X)"

**Issues from Playtest Report:**
- âœ… Flickering reduced by increasing FPS to 30 (user suggested 24-30)
- âœ… Border alignment fixed (separator lines were 70 chars, now 74)
- âœ… Energy jumping fixed (BuildingManager now calculates net production rates)
- âœ… Save clarity improved (shows filename and Sol in message)
- â­ï¸ Auto-save feature (deferred to v0.3)
- â­ï¸ Tutorial/dialogs for starting resources (deferred to v0.3)
- â­ï¸ Color coding for structures (deferred to v0.3)
- â­ï¸ Partial screen updates instead of full clear (investigate TUI libraries for v0.3)

**Root Cause Analysis:**
1. **Flickering:** 2 FPS was too slow - screen clears were visible to human eye. 30 FPS makes clears imperceptible.
2. **Border alignment:** Separator lines had 66 dashes instead of 69, making total 70 chars instead of 74.
3. **Energy jumping:** BuildingManager._update_production_rates() only set production rates, not net (production - consumption). When returning from build menu, there was a frame where production was shown without consumption subtracted.
4. **Save clarity:** Message was too generic ("Game saved") - users couldn't tell what file or which save.

**Testing Notes:**
- User confirmed many improvements in playtest
- All research working correctly
- Building purchases working correctly
- Save/load working correctly
- Main issues are now visual polish and UX improvements

**Next Steps:**
- User to playtest Round 2 fixes
- If successful, merge to main and begin v0.3 planning

---

### 2025-10-03 - Architectural Fix: Screen Rendering (Round 3)

**Issue Identified:**
User reported flickering got WORSE after Round 2 FPS increase to 30 FPS:
> "okay the flickering is even worse now on the main screen. i was unable to test much or even debug really it was going to quick."

**Root Cause Analysis:**
The problem was NOT the FPS - it was the fundamental rendering architecture:
- Using `os.system('clear')` spawns a shell subprocess every frame
- Creates visible blank screen between clear and redraw
- Higher FPS = MORE frequent clearing = MORE visible flicker
- Architecture was fundamentally wrong for terminal games

**Research Findings:**
Investigated Python TUI libraries:
1. **Textual** - Modern async TUI framework, zero flicker, widget-based (best for v0.3)
2. **Rich** - Modern formatting library with Live display context (good intermediate)
3. **Blessed** - Curses wrapper, easier than raw curses
4. **Cursor Positioning** - Replace os.system() with ANSI escape codes (immediate fix)

**Solution Applied:**
Changed `engine/ui_framework.py` clear_screen() method (lines 309-315):

**Before:**
```python
def clear_screen(self):
    """Clear the terminal screen."""
    if os.name == 'nt':  # Windows
        os.system('cls')
    else:  # Unix/Linux/Mac
        os.system('clear')
    logger.debug("Screen cleared")
```

**After:**
```python
def clear_screen(self):
    """Clear the terminal screen using ANSI escape sequences."""
    # Use ANSI escape codes instead of os.system() to reduce flicker
    # \033[H moves cursor to 0,0
    # \033[2J clears entire screen
    print('\033[H\033[2J', end='', flush=True)
    logger.debug("Screen cleared")
```

**Why This Helps:**
- ANSI escape codes processed directly by terminal emulator (much faster)
- No shell subprocess spawned
- More atomic operation
- Significantly reduces flicker at any FPS

**Future Plans:**
- If flickering persists, investigate Rich's Live display for v0.2
- For v0.3: Full migration to Textual framework for proper TUI architecture

**Files Changed:**
- engine/ui_framework.py:309-315 - Replaced os.system() with ANSI escape sequences

**Next Steps:**
- User to playtest Round 3 architectural fix
- Verify flickering is resolved
- If successful, proceed with Round 2 border alignment testing

---

## ðŸ§ª Testing Checklist

Before merging v0.2-dev to main:

- [ ] Building construction works (Solar Array, Mining Rig)
- [ ] Research purchases work (all upgrades)
- [ ] Menu doesn't flicker
- [ ] Borders aligned properly
- [ ] Save/load still works
- [ ] All resources display correctly
- [ ] Game runs for 10+ minutes without errors
- [ ] Played through early game progression

---

## ðŸ“Š Metrics

**Bugs Fixed (Round 1):** 4/4 âœ…
**Bugs Fixed (Round 2):** 4/4 âœ…
**Architectural Fixes (Round 3):** 1/1 âœ…
**Total Bug Fixes:** 9 fixes across 3 rounds
**Test Runs:** 4 (initialization + functionality + user playtest + architecture)
**Commits:** 0 (not yet committed)
**Status:** Round 3 Architectural Fix Complete - Ready for Playtest

---

## ðŸ’­ Notes & Observations

*Use this space for random thoughts, discoveries, and insights during development*

---

**Branch Status:** v0.2-dev (active development)
**Last Updated:** 2025-10-03 (Round 3 architectural fix)
