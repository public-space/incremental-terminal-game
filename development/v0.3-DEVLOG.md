# v0.3 Development Log

**Version:** v0.3
**Branch:** v0.3-dev
**Focus:** TUI Framework Migration (Textual)
**Started:** 2025-10-03

---

## 🎯 v0.3 Goals

**Primary Objective:** Migrate from manual ANSI rendering to Textual TUI framework

**Secondary Objectives:**
- Fix flickering permanently
- Add deferred v0.2 features (auto-save, dialogs, color coding)
- Improve overall UX and visual polish

**Philosophy:**
> "The v0.2 band-aids proved the architecture needs a proper foundation. Time to build it right."

---

## 🏗️ Architecture Migration Plan

### Current Architecture (v0.2)
```
colony/main.py
├── engine/ui_framework.py (manual ANSI codes)
├── colony/ui/main_screen.py (manual print statements)
├── colony/ui/build_menu.py (manual print statements)
├── colony/ui/research_menu.py (manual print statements)
└── colony/ui/help_screen.py (manual print statements)
```

**Problems:**
- Manual screen clearing causes flicker
- Full screen redraws every frame
- No partial updates
- Border alignment issues
- Command input timing issues

### Target Architecture (v0.3)
```
colony/main.py
├── engine/textual_framework.py (Textual App wrapper)
├── colony/ui/screens/main_screen.py (Textual Screen)
├── colony/ui/screens/build_screen.py (Textual Screen)
├── colony/ui/screens/research_screen.py (Textual Screen)
└── colony/ui/widgets/ (reusable Textual widgets)
    ├── resource_panel.py
    ├── building_list.py
    ├── event_log.py
    └── stat_display.py
```

**Benefits:**
- Zero flicker (Textual handles partial updates)
- Widget-based architecture (reusable components)
- Async event loop (better for incremental games)
- Automatic border alignment
- Built-in keyboard/mouse handling
- Rich integration (keep colors/formatting)

---

## 📋 Phase 1: Research & Prototype

### Tasks:
- [x] Create v0.3-dev branch
- [ ] Install Textual library
- [ ] Research Textual App structure
- [ ] Research Textual Screen lifecycle
- [ ] Research Textual Widget system
- [ ] Create simple "Hello World" Textual app
- [ ] Prototype main screen in Textual
- [ ] Compare prototype vs current implementation

### Key Questions to Answer:
1. How does Textual's event loop integrate with our existing GameLoop?
2. Can we keep engine/resources.py, engine/buildings.py unchanged?
3. How do we handle the tick-based game state updates?
4. What's the migration path? (Big bang vs incremental)

---

## 📋 Phase 2: Core Migration

### Tasks:
- [ ] Create engine/textual_framework.py wrapper
- [ ] Migrate main_screen.py to Textual Screen
- [ ] Integrate game state updates with Textual reactive system
- [ ] Add resource panel widget
- [ ] Add building list widget
- [ ] Add event log widget
- [ ] Test main screen functionality

---

## 📋 Phase 3: Menu Migration

### Tasks:
- [ ] Migrate build_menu to Textual Screen
- [ ] Migrate research_menu to Textual Screen
- [ ] Migrate help_screen to Textual Screen
- [ ] Add screen navigation
- [ ] Test all menus

---

## 📋 Phase 4: Feature Additions (Deferred from v0.2)

### Tasks:
- [ ] Auto-save every 60 seconds
- [ ] Tutorial dialog on first launch
- [ ] Hint system for resource management
- [ ] Color coding for structure status (active/idle/offline)
- [ ] Improved save/load UI with multiple save slots
- [ ] Better command input (no timing issues)

---

## 📋 Phase 5: Polish & Testing

### Tasks:
- [ ] Visual polish pass
- [ ] Performance testing
- [ ] Full playthrough testing
- [ ] Compare v0.2 vs v0.3 performance
- [ ] Documentation updates
- [ ] Merge to main

---

## 📝 Development Log

### 2025-10-03 - Planning Session

**Context:**
v0.2 bug fixes revealed fundamental architectural issues with manual ANSI rendering:
- Flickering persisted despite FPS changes and ANSI escape sequence optimization
- Root cause: Full screen redraws every frame
- Band-aid fixes not worth pursuing when v0.3 needs TUI framework anyway

**User Feedback:**
> "it seems you may have forgotten to change the 30fps? it's still very bad. i feel like there isnt much of a point trying to do a temporary fix when everything else works. and the only things that aren't working are things we're going to change for v0.3. So my say is we move on to 0.3 and begin the transfer to a fuller tui library"

**Decisions:**
- Skip further v0.2 rendering fixes
- v0.2 game mechanics are solid (buildings, research, save/load all work)
- Focus v0.3 on proper TUI architecture with Textual
- Researched Terminal_Descent (similar game) but code not public
- Chose Textual as modern standard (2025, actively maintained, zero-flicker)

**Actions:**
- Created v0.3-dev branch
- Created this planning document
- Installed Textual 6.2.0
- Created hello world test (successful)
- Created main screen prototype (successful - ZERO FLICKER!)

**Success:**
✅ Textual prototype WORKS! Zero flickering confirmed.
✅ Game loop integration via Workers functional
✅ Layout system clean and maintainable
✅ Ready for full migration

**Next Steps:**
1. Wire up reactive data to prototype widgets
2. Add command handlers (build/research/save menus)
3. Test full prototype with real game loop
4. Begin full migration to Textual

**References:**
- Textual: https://textual.textualize.io/
- Rich: https://rich.readthedocs.io/
- Real Python Textual tutorial: https://realpython.com/python-textual/

---

## 🧪 Testing Checklist

Before merging v0.3-dev to main:

- [ ] No flickering on any screen
- [ ] All v0.2 functionality preserved (buildings, research, save/load)
- [ ] Auto-save working
- [ ] Tutorial/dialogs working
- [ ] Color coding for structures
- [ ] Command input reliable (no timing issues)
- [ ] Game runs stable for 30+ minutes
- [ ] Performance equal or better than v0.2
- [ ] All borders aligned
- [ ] Visual polish complete

---

## 📊 Metrics

**Phase:** Prototype Complete
**Commits:** 0
**Files Created:** 3 (hello world test, main screen prototype, devlog)
**Status:** ✅ PROTOTYPE SUCCESS - Zero Flicker Confirmed!

---

## 💭 Notes & Observations

### Why Textual Over Alternatives?

**Textual vs Rich:**
- Rich is a formatting library
- Rich.Live provides flicker-free updates but still manual layout
- Textual is built ON TOP of Rich, adds full TUI framework
- Textual = Rich + Widgets + Screens + Event Loop

**Textual vs Blessed:**
- Blessed is a curses wrapper (lower level)
- More manual work for layouts, widgets
- Textual provides higher-level abstractions

**Textual vs Raw Curses:**
- Curses is powerful but very low-level
- Cross-platform issues (Windows requires windows-curses)
- Textual handles all platform differences

**Textual Benefits:**
- Modern async/await architecture
- CSS-like styling system
- Hot reload during development
- Excellent documentation
- Active community
- Battle-tested (used in production apps)

---

**Branch Status:** v0.3-dev (prototype successful)
**Last Updated:** 2025-10-03 (Prototype validated - ZERO FLICKER!)
